-- ============================================================================
-- TDF DATA PLATFORM - SEED DATA: INFRASTRUCTURE DETAIL TABLES
-- ============================================================================
-- Enhancement tables for complete infrastructure coverage:
-- - ROOFTOPS (8,174 PoS locations)
-- - INDOOR_SITES (908 DAS installations)
-- - ANTENNAS (~25,000)
-- - BROADCAST_TRANSMITTERS (~3,500)
-- - FIBRE_NETWORK (5,500 km)
-- - POINTS_OF_SERVICE (21,244 combined)
-- ============================================================================

USE ROLE SYSADMIN;
USE WAREHOUSE TDF_WH;
USE DATABASE TDF_DATA_PLATFORM;
USE SCHEMA INFRASTRUCTURE;

-- ============================================================================
-- ROOFTOPS (8,174 Building Rooftop Installations)
-- ============================================================================

INSERT INTO ROOFTOPS (
    ROOFTOP_ID, SITE_ID, ROOFTOP_CODE,
    BUILDING_NAME, BUILDING_TYPE, BUILDING_HEIGHT_M, ROOF_TYPE, ROOF_AREA_M2,
    INSTALLATION_DATE, INSTALLATION_TYPE, MAST_HEIGHT_M, MAX_EQUIPMENT_WEIGHT_KG,
    ACCESS_TYPE, ACCESS_RESTRICTIONS,
    LANDLORD_TYPE, CONTRACT_TYPE, MONTHLY_RENT_EUR
)
SELECT 
    'RTF-' || LPAD(ROW_NUMBER() OVER (ORDER BY SITE_ID), 6, '0') AS ROOFTOP_ID,
    SITE_ID,
    'RTF-' || SITE_CODE AS ROOFTOP_CODE,
    CASE MOD(ROW_NUMBER() OVER (ORDER BY SITE_ID), 10)
        WHEN 0 THEN 'Résidence Les Horizons'
        WHEN 1 THEN 'Tour Montparnasse Sud'
        WHEN 2 THEN 'Immeuble République'
        WHEN 3 THEN 'Centre Commercial Carrefour'
        WHEN 4 THEN 'Hôpital Universitaire'
        WHEN 5 THEN 'Lycée Jean Moulin'
        WHEN 6 THEN 'Mairie de ' || CITY
        WHEN 7 THEN 'Église Saint-Pierre'
        WHEN 8 THEN 'Immeuble Le Parc'
        ELSE 'Bâtiment Industriel Zone A'
    END AS BUILDING_NAME,
    CASE MOD(ROW_NUMBER() OVER (ORDER BY SITE_ID), 5)
        WHEN 0 THEN 'RESIDENTIAL'
        WHEN 1 THEN 'COMMERCIAL'
        WHEN 2 THEN 'PUBLIC'
        WHEN 3 THEN 'INDUSTRIAL'
        ELSE 'RESIDENTIAL'
    END AS BUILDING_TYPE,
    UNIFORM(15, 80, RANDOM()) AS BUILDING_HEIGHT_M,
    CASE MOD(ROW_NUMBER() OVER (ORDER BY SITE_ID), 3)
        WHEN 0 THEN 'FLAT'
        WHEN 1 THEN 'TERRACE'
        ELSE 'PITCHED'
    END AS ROOF_TYPE,
    UNIFORM(50, 500, RANDOM()) AS ROOF_AREA_M2,
    COMMISSIONING_DATE AS INSTALLATION_DATE,
    CASE MOD(ROW_NUMBER() OVER (ORDER BY SITE_ID), 3)
        WHEN 0 THEN 'MAST'
        WHEN 1 THEN 'FRAME'
        ELSE 'WALL_MOUNT'
    END AS INSTALLATION_TYPE,
    UNIFORM(3, 15, RANDOM()) AS MAST_HEIGHT_M,
    UNIFORM(200, 1000, RANDOM()) AS MAX_EQUIPMENT_WEIGHT_KG,
    CASE MOD(ROW_NUMBER() OVER (ORDER BY SITE_ID), 3)
        WHEN 0 THEN '24_7'
        WHEN 1 THEN 'BUSINESS_HOURS'
        ELSE 'APPOINTMENT'
    END AS ACCESS_TYPE,
    CASE WHEN UNIFORM(0, 100, RANDOM()) < 30 THEN 'Préavis 48h requis' ELSE NULL END AS ACCESS_RESTRICTIONS,
    CASE MOD(ROW_NUMBER() OVER (ORDER BY SITE_ID), 4)
        WHEN 0 THEN 'PRIVATE'
        WHEN 1 THEN 'CONDO'
        WHEN 2 THEN 'SOCIAL_HOUSING'
        ELSE 'PUBLIC'
    END AS LANDLORD_TYPE,
    'LEASE' AS CONTRACT_TYPE,
    UNIFORM(500, 3000, RANDOM()) AS MONTHLY_RENT_EUR
FROM SITES
WHERE SITE_TYPE = 'ROOFTOP' AND STATUS = 'ACTIVE'
LIMIT 8174;

-- ============================================================================
-- INDOOR_SITES (908 Indoor DAS Installations)
-- ============================================================================

INSERT INTO INDOOR_SITES (
    INDOOR_SITE_ID, SITE_ID, INDOOR_CODE,
    VENUE_NAME, VENUE_TYPE, VENUE_AREA_M2, FLOORS_COVERED,
    DAS_TYPE, ANTENNA_COUNT, COVERAGE_AREA_M2,
    CONTRACT_START_DATE, CONTRACT_END_DATE, ANNUAL_FEE_EUR
)
SELECT 
    'IND-' || LPAD(ROW_NUMBER() OVER (ORDER BY SITE_ID), 5, '0') AS INDOOR_SITE_ID,
    SITE_ID,
    'IND-' || SITE_CODE AS INDOOR_CODE,
    CASE MOD(ROW_NUMBER() OVER (ORDER BY SITE_ID), 10)
        WHEN 0 THEN 'Centre Commercial Les 4 Temps'
        WHEN 1 THEN 'Gare SNCF ' || CITY
        WHEN 2 THEN 'Aéroport ' || CITY
        WHEN 3 THEN 'CHU ' || CITY
        WHEN 4 THEN 'Stade Municipal'
        WHEN 5 THEN 'Métro Ligne A'
        WHEN 6 THEN 'Galeries Lafayette'
        WHEN 7 THEN 'Palais des Congrès'
        WHEN 8 THEN 'Campus Universitaire'
        ELSE 'Parking Souterrain Centre-Ville'
    END AS VENUE_NAME,
    CASE MOD(ROW_NUMBER() OVER (ORDER BY SITE_ID), 6)
        WHEN 0 THEN 'SHOPPING_CENTER'
        WHEN 1 THEN 'AIRPORT'
        WHEN 2 THEN 'STADIUM'
        WHEN 3 THEN 'HOSPITAL'
        WHEN 4 THEN 'METRO'
        ELSE 'CONVENTION_CENTER'
    END AS VENUE_TYPE,
    UNIFORM(5000, 200000, RANDOM()) AS VENUE_AREA_M2,
    UNIFORM(2, 10, RANDOM()) AS FLOORS_COVERED,
    CASE MOD(ROW_NUMBER() OVER (ORDER BY SITE_ID), 3)
        WHEN 0 THEN 'ACTIVE_DAS'
        WHEN 1 THEN 'PASSIVE_DAS'
        ELSE 'SMALL_CELL'
    END AS DAS_TYPE,
    UNIFORM(20, 200, RANDOM()) AS ANTENNA_COUNT,
    UNIFORM(4000, 180000, RANDOM()) AS COVERAGE_AREA_M2,
    DATEADD(YEAR, -UNIFORM(1, 8, RANDOM()), CURRENT_DATE()) AS CONTRACT_START_DATE,
    DATEADD(YEAR, UNIFORM(5, 15, RANDOM()), CURRENT_DATE()) AS CONTRACT_END_DATE,
    UNIFORM(50000, 500000, RANDOM()) AS ANNUAL_FEE_EUR
FROM SITES
WHERE SITE_TYPE = 'INDOOR' AND STATUS = 'ACTIVE'
LIMIT 908;

-- ============================================================================
-- ANTENNAS (~25,000 Antenna Installations)
-- ============================================================================

INSERT INTO ANTENNAS (
    ANTENNA_ID, EQUIPMENT_ID, SITE_ID, TOWER_ID,
    ANTENNA_TYPE, TECHNOLOGY, FREQUENCY_BAND, GAIN_DBI,
    HEIGHT_M, AZIMUTH_DEG, TILT_DEG, POLARIZATION,
    OPERATOR_ID
)
SELECT 
    'ANT-' || LPAD(ROW_NUMBER() OVER (ORDER BY e.EQUIPMENT_ID), 6, '0') AS ANTENNA_ID,
    e.EQUIPMENT_ID,
    e.SITE_ID,
    e.TOWER_ID,
    CASE MOD(ROW_NUMBER() OVER (ORDER BY e.EQUIPMENT_ID), 4)
        WHEN 0 THEN 'PANEL'
        WHEN 1 THEN 'PANEL'
        WHEN 2 THEN 'OMNI'
        ELSE 'PARABOLIC'
    END AS ANTENNA_TYPE,
    CASE MOD(ROW_NUMBER() OVER (ORDER BY e.EQUIPMENT_ID), 7)
        WHEN 0 THEN '4G'
        WHEN 1 THEN '4G'
        WHEN 2 THEN '5G'
        WHEN 3 THEN '5G'
        WHEN 4 THEN 'DTT'
        WHEN 5 THEN 'RADIO'
        ELSE 'DAB'
    END AS TECHNOLOGY,
    CASE MOD(ROW_NUMBER() OVER (ORDER BY e.EQUIPMENT_ID), 6)
        WHEN 0 THEN '700MHz'
        WHEN 1 THEN '800MHz'
        WHEN 2 THEN '1800MHz'
        WHEN 3 THEN '2100MHz'
        WHEN 4 THEN '2600MHz'
        ELSE '3500MHz'
    END AS FREQUENCY_BAND,
    UNIFORM(10, 25, RANDOM()) AS GAIN_DBI,
    UNIFORM(20, 100, RANDOM()) AS HEIGHT_M,
    UNIFORM(0, 359, RANDOM()) AS AZIMUTH_DEG,
    UNIFORM(0, 15, RANDOM()) AS TILT_DEG,
    CASE WHEN UNIFORM(0, 100, RANDOM()) < 80 THEN 'CROSS' ELSE 'VERTICAL' END AS POLARIZATION,
    CASE MOD(ROW_NUMBER() OVER (ORDER BY e.EQUIPMENT_ID), 5)
        WHEN 0 THEN 'OP-ORANGE'
        WHEN 1 THEN 'OP-SFR'
        WHEN 2 THEN 'OP-BOUYGUES'
        WHEN 3 THEN 'OP-FREE'
        ELSE 'OP-TDF-BC'
    END AS OPERATOR_ID
FROM EQUIPMENT e
WHERE e.EQUIPMENT_CATEGORY = 'ANTENNA'
LIMIT 25000;

-- ============================================================================
-- BROADCAST_TRANSMITTERS (~3,500 TV/Radio Transmitters)
-- ============================================================================

INSERT INTO BROADCAST_TRANSMITTERS (
    TRANSMITTER_ID, EQUIPMENT_ID, SITE_ID,
    BROADCAST_TYPE, SERVICE_NAME,
    FREQUENCY_MHZ, POWER_KW, ERP_KW, COVERAGE_RADIUS_KM, POPULATION_COVERED,
    LICENSE_NUMBER, LICENSE_EXPIRY_DATE
)
SELECT 
    'TX-' || LPAD(ROW_NUMBER() OVER (ORDER BY e.EQUIPMENT_ID), 5, '0') AS TRANSMITTER_ID,
    e.EQUIPMENT_ID,
    e.SITE_ID,
    CASE MOD(ROW_NUMBER() OVER (ORDER BY e.EQUIPMENT_ID), 4)
        WHEN 0 THEN 'DTT'
        WHEN 1 THEN 'FM_RADIO'
        WHEN 2 THEN 'DAB_PLUS'
        ELSE 'FM_RADIO'
    END AS BROADCAST_TYPE,
    CASE MOD(ROW_NUMBER() OVER (ORDER BY e.EQUIPMENT_ID), 15)
        WHEN 0 THEN 'France 2'
        WHEN 1 THEN 'TF1'
        WHEN 2 THEN 'France 3'
        WHEN 3 THEN 'M6'
        WHEN 4 THEN 'France Inter'
        WHEN 5 THEN 'RTL'
        WHEN 6 THEN 'Europe 1'
        WHEN 7 THEN 'NRJ'
        WHEN 8 THEN 'France Info'
        WHEN 9 THEN 'RMC'
        WHEN 10 THEN 'France Culture'
        WHEN 11 THEN 'Nostalgie'
        WHEN 12 THEN 'Skyrock'
        WHEN 13 THEN 'Chérie FM'
        ELSE 'Fun Radio'
    END AS SERVICE_NAME,
    CASE MOD(ROW_NUMBER() OVER (ORDER BY e.EQUIPMENT_ID), 4)
        WHEN 0 THEN UNIFORM(470, 790, RANDOM())  -- DTT UHF
        WHEN 1 THEN UNIFORM(87.5, 108.0, RANDOM())  -- FM
        WHEN 2 THEN UNIFORM(174, 240, RANDOM())  -- DAB+
        ELSE UNIFORM(87.5, 108.0, RANDOM())
    END AS FREQUENCY_MHZ,
    UNIFORM(0.1, 100, RANDOM()) AS POWER_KW,
    UNIFORM(1, 500, RANDOM()) AS ERP_KW,
    UNIFORM(20, 150, RANDOM()) AS COVERAGE_RADIUS_KM,
    UNIFORM(50000, 5000000, RANDOM()) AS POPULATION_COVERED,
    'CSA-' || LPAD(ROW_NUMBER() OVER (ORDER BY e.EQUIPMENT_ID), 8, '0') AS LICENSE_NUMBER,
    DATEADD(YEAR, UNIFORM(2, 10, RANDOM()), CURRENT_DATE()) AS LICENSE_EXPIRY_DATE
FROM EQUIPMENT e
WHERE e.EQUIPMENT_CATEGORY = 'TRANSMITTER'
LIMIT 3500;

-- ============================================================================
-- FIBRE_NETWORK (5,500 km Optical Fibre in ~550 segments)
-- ============================================================================

INSERT INTO FIBRE_NETWORK (
    SEGMENT_ID, SEGMENT_CODE,
    START_SITE_ID, END_SITE_ID, START_CITY, END_CITY,
    LENGTH_KM, FIBRE_COUNT, FIBRE_TYPE, CAPACITY_GBPS,
    STATUS, INSTALLATION_DATE
)
SELECT 
    'FIB-' || LPAD(ROW_NUMBER() OVER (ORDER BY s1.SITE_ID), 5, '0') AS SEGMENT_ID,
    'FIB-SEG-' || LPAD(ROW_NUMBER() OVER (ORDER BY s1.SITE_ID), 4, '0') AS SEGMENT_CODE,
    s1.SITE_ID AS START_SITE_ID,
    s2.SITE_ID AS END_SITE_ID,
    s1.CITY AS START_CITY,
    s2.CITY AS END_CITY,
    UNIFORM(5, 50, RANDOM()) AS LENGTH_KM,  -- Average ~10km per segment = 5500km total
    CASE 
        WHEN UNIFORM(0, 100, RANDOM()) < 30 THEN 96
        WHEN UNIFORM(0, 100, RANDOM()) < 60 THEN 48
        ELSE 24
    END AS FIBRE_COUNT,
    CASE WHEN UNIFORM(0, 100, RANDOM()) < 90 THEN 'SINGLE_MODE' ELSE 'MULTI_MODE' END AS FIBRE_TYPE,
    CASE 
        WHEN UNIFORM(0, 100, RANDOM()) < 40 THEN 100
        WHEN UNIFORM(0, 100, RANDOM()) < 70 THEN 400
        ELSE 800
    END AS CAPACITY_GBPS,
    'ACTIVE' AS STATUS,
    DATEADD(YEAR, -UNIFORM(1, 15, RANDOM()), CURRENT_DATE()) AS INSTALLATION_DATE
FROM (SELECT SITE_ID, CITY FROM SITES WHERE STATUS = 'ACTIVE' ORDER BY RANDOM() LIMIT 550) s1
CROSS JOIN (SELECT SITE_ID, CITY FROM SITES WHERE STATUS = 'ACTIVE' ORDER BY RANDOM() LIMIT 1) s2
WHERE s1.SITE_ID != s2.SITE_ID
LIMIT 550;

-- ============================================================================
-- POINTS_OF_SERVICE (21,244 Combined PoS/PoP)
-- Based on TDF Investor Presentation structure
-- ============================================================================

-- Telecom Points of Service (from Client Installations)
INSERT INTO POINTS_OF_SERVICE (
    POS_ID, SITE_ID, POS_TYPE, OPERATOR_ID, SERVICE_TYPE, STATUS, ACTIVATION_DATE
)
SELECT 
    'POS-TEL-' || LPAD(ROW_NUMBER() OVER (ORDER BY INSTALLATION_ID), 6, '0') AS POS_ID,
    SITE_ID,
    'TELECOM' AS POS_TYPE,
    OPERATOR_ID,
    '4G/5G Site Hosting' AS SERVICE_TYPE,
    STATUS,
    CONTRACT_START_DATE AS ACTIVATION_DATE
FROM CLIENT_INSTALLATIONS
WHERE STATUS = 'ACTIVE'
LIMIT 15000;

-- Broadcast Points of Service
INSERT INTO POINTS_OF_SERVICE (
    POS_ID, SITE_ID, POS_TYPE, OPERATOR_ID, SERVICE_TYPE, STATUS, ACTIVATION_DATE
)
SELECT 
    'POS-BC-' || LPAD(ROW_NUMBER() OVER (ORDER BY s.SITE_ID), 5, '0') AS POS_ID,
    s.SITE_ID,
    'BROADCAST' AS POS_TYPE,
    'OP-TDF-BC' AS OPERATOR_ID,
    CASE MOD(ROW_NUMBER() OVER (ORDER BY s.SITE_ID), 3)
        WHEN 0 THEN 'DTT Transmission'
        WHEN 1 THEN 'FM Radio'
        ELSE 'DAB+ Digital Radio'
    END AS SERVICE_TYPE,
    'ACTIVE' AS STATUS,
    s.COMMISSIONING_DATE AS ACTIVATION_DATE
FROM SITES s
WHERE s.STATUS = 'ACTIVE' AND s.SITE_TYPE = 'TOWER'
ORDER BY RANDOM()
LIMIT 4000;

-- Edge/Data Center Points of Service
INSERT INTO POINTS_OF_SERVICE (
    POS_ID, SITE_ID, POS_TYPE, OPERATOR_ID, SERVICE_TYPE, STATUS, ACTIVATION_DATE
)
SELECT 
    'POS-EDGE-' || LPAD(ROW_NUMBER() OVER (ORDER BY DC_ID), 4, '0') AS POS_ID,
    SITE_ID,
    'EDGE' AS POS_TYPE,
    NULL AS OPERATOR_ID,
    'Edge Computing / Colocation' AS SERVICE_TYPE,
    'ACTIVE' AS STATUS,
    DATEADD(YEAR, -UNIFORM(1, 5, RANDOM()), CURRENT_DATE()) AS ACTIVATION_DATE
FROM DATA_CENTERS
LIMIT 106;

-- Indoor Points of Service
INSERT INTO POINTS_OF_SERVICE (
    POS_ID, SITE_ID, POS_TYPE, OPERATOR_ID, SERVICE_TYPE, STATUS, ACTIVATION_DATE
)
SELECT 
    'POS-IND-' || LPAD(ROW_NUMBER() OVER (ORDER BY INDOOR_SITE_ID), 4, '0') AS POS_ID,
    SITE_ID,
    'INDOOR' AS POS_TYPE,
    CASE MOD(ROW_NUMBER() OVER (ORDER BY INDOOR_SITE_ID), 4)
        WHEN 0 THEN 'OP-ORANGE'
        WHEN 1 THEN 'OP-SFR'
        WHEN 2 THEN 'OP-BOUYGUES'
        ELSE 'OP-FREE'
    END AS OPERATOR_ID,
    'Indoor DAS Coverage' AS SERVICE_TYPE,
    'ACTIVE' AS STATUS,
    CONTRACT_START_DATE AS ACTIVATION_DATE
FROM INDOOR_SITES
LIMIT 2138;

SELECT 'INFRASTRUCTURE DETAIL DATA SEEDED' AS STATUS,
       (SELECT COUNT(*) FROM ROOFTOPS) AS ROOFTOPS_COUNT,
       (SELECT COUNT(*) FROM INDOOR_SITES) AS INDOOR_SITES_COUNT,
       (SELECT COUNT(*) FROM ANTENNAS) AS ANTENNAS_COUNT,
       (SELECT COUNT(*) FROM BROADCAST_TRANSMITTERS) AS TRANSMITTERS_COUNT,
       (SELECT COUNT(*) FROM FIBRE_NETWORK) AS FIBRE_SEGMENTS_COUNT,
       (SELECT COUNT(*) FROM POINTS_OF_SERVICE) AS POS_COUNT;

